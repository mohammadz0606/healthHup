<%- include("../partials/head.ejs") %>

<%- include("../partials/navbar.ejs") %>


<%



var tests = [
  'Boold Test',
  'Iron Test',
  'B12 Test',
  'pH Test',
  'Density Test',
  'Flame Test',
  'Ink Chromatography',
  'Water Electrolysis',
  'Vitamin C Test',
  'Catalase Reaction',
  'Potato Osmosis',
  'Agar Diffusion',
  'Baking Soda and Vinegar Reaction'
  ]
%>

<style>
    .doc1{
        margin: 50px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

            h1 {
        color: #1D2A4D;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
       
        
      
    }
    th {
        background-color: #5567d1;
        color: white;
    }
    tr{
        background-color: #f2f2f2;
        transition-property: background-color;
        transition-duration: 0.5s;
    }
 
    tr:hover   {
        
        background-color: #5567d1;
        color: white;
    }
    .hidden {
    display: none;
   
}


/* Style the feedback div */
#feedbackDiv {
    position: fixed;
    top: 33%;
    left:40%;
    z-index: 1000;
    transform: none;
    background-color: #f9f9f9;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 12px 10px 25px rgb(169 169 169 / 42%);
    min-width: 420px;
    
    
}
#otherDiv {
    position: fixed;
    top: 33%;
    left:40%;
    z-index: 1000;
    transform: none;
    background-color: #f9f9f9;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 12px 10px 25px rgb(169 169 169 / 42%);
    min-width: 420px;
    
}


.Sendbtn{
  font-family: inherit;
  font-size: 20px;
  background: royalblue;
  color: white;
  padding: 0.5em 0.8em;
  /* padding-left: 0.9em; */
  min-width: 100px;
  margin: 5px;
  display: flex;
  align-items: center;
  border: none;
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.2s;
  cursor: pointer;
}

.Sendbtn span {
  display: block;
  margin-left: 0.3em;
  transition: all 0.3s ease-in-out;
}

.Sendbtn svg {
  display: block;
  transform-origin: center center;
  transition: transform 0.3s ease-in-out;
}

.Sendbtn:hover .svg-wrapper {
  animation: fly-1 0.6s ease-in-out infinite alternate;
}

.Sendbtn:hover svg {
  transform: translateX(1.2em) rotate(45deg) scale(1.1);
}

.Sendbtn:hover span {
  transform: translateX(5em);
}

.Sendbtn:active {
  transform: scale(0.95);
}
.Closebtn{
  font-family: inherit;
  font-size: 20px;
  background: RED;
  color: white;
  padding: 0.5em 0.8em;
  padding-left: 0.9em;
  margin: 5px;
  display: flex;
  align-items: center;
  border: none;
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.2s;
  cursor: pointer;
}

.Closebtn span {
  display: block;
  margin-left: 0.3em;
  transition: all 0.3s ease-in-out;
}

.Closebtn svg {
  display: block;
  transform-origin: center center;
  transition: transform 0.3s ease-in-out;
}

.Closebtn:hover .svg-wrapper {
  animation: fly-1 0.6s ease-in-out infinite alternate;
}

.Closebtn:hover svg {
  transform: translateX(1.2em)  scale(1.1);
}

.Closebtn:hover span {
  transform: translateX(5em);
}

.Closebtn:active {
  transform: scale(0.95);
}


@keyframes fly-1 {
  from {
    transform: translateY(0.1em);
  }

  to {
    transform: translateY(-0.1em);
  }
}
#feedbackButton{
    width: 200px;
}
#otherButton{
    width: 200px;
}

@media (max-width:600px){

  #feedbackDiv {
    position: fixed;
    top: 33%;
    left: 0%;
    z-index: 1000;
    transform: none;
    background-color: #f9f9f9;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 12px 10px 25px rgb(169 169 169 / 42%);
    min-width: 420px;
    margin: 20px;
  }
  #otherDiv {
    position: fixed;
    top: 33%;
    left: 0%;
    z-index: 1000;
    transform: none;
    background-color: #f9f9f9;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 12px 10px 25px rgb(169 169 169 / 42%);
    min-width: 420px;
    margin: 20px;
}
}

.form-check:hover, .form-check-label:hover {
  cursor: pointer !important;
}
</style>



<div class="doc1"> 
    
    <h1>Patient's Information</h1>
    
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Appointment Time</th>
                <th>Medical History</th>
                <th>Lab Tests</th>
                <th>Patient Information</th>
                <th>Medicine</th>
                <th>Status</th>
                <th><a href="/decline-all/appointments/<%= currentUser._id %>" class="btn btn-danger" style="width: 130px;"><i class="bi bi-calendar-x"></i> Decline all</a></th>
            </tr>
        </thead>
        <tbody>
            <% doctorAppointments.reverse().forEach((doctorAppointment, index) => { %>
                <tr>
                    <td ><%= ++index %></td>
                    <td ><%= doctorAppointment.name %></td>
                    <td ><%= doctorAppointment.age %></td>
                    <td ><%= doctorAppointment.gender %></td>
                    <td ><%= moment(doctorAppointment.creactionDate).format("YYYY-MM-DD HH:MM A")  %></td>
                    <td>
                      <p><%= doctorAppointment.medicalHistory %></p>
                    </td>
                    <td style="min-width: 200px;">
                      <% doctorAppointment.labTests.forEach((test) => { %>
                        <p><%= test %></p>
                        
                      <% }) %>
                      
                      <br>
                     
                      <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" data-bs-target="#add-more-test-<%= doctorAppointment._id %>" aria-expanded="false" aria-controls="add-more-test-<%= doctorAppointment._id %>">
                        Add more Lab Tests
                      </button>
                      <div class="collapse mt-4" id="add-more-test-<%= doctorAppointment._id %>">
                        <div class="col-12">
                          <form action="/appointment/modify-lab-tests/<%= doctorAppointment._id %>" method="post">
                            <% tests.forEach((test) => { %>
                              <% if(doctorAppointment.labTests.includes(test)) { %>
                                <div class="form-check" style="text-align: left !important">
                                  <input class="form-check-input" checked type="checkbox" name="labTests" value="<%= test %>" id="<%= test %>-<%= doctorAppointment._id %>">
                                    <label class="form-check-label" for="<%= test %>-<%= doctorAppointment._id %>">
                                    <%= test %>
                                    </label>
                                </div>
                              <% } else { %>
                                <div class="form-check" style="text-align: left !important">
                                  <input class="form-check-input"  type="checkbox" name="labTests" value="<%= test %>" id="<%= test %>-<%= doctorAppointment._id %>">
                                    <label class="form-check-label" for="<%= test %>-<%= doctorAppointment._id %>">
                                    <%= test %>
                                    </label>
                                </div>
                              <% } %>
                             
                            <% }) %>
                            <button class="btn btn-success mt-4">Save Tests</button>
                          </form>
                      </div>
                      </div>
                      
                    </td>
                    <td style="min-width: 400px;">
                        <div class="form-outline">
                            <label class="form-label" style="font-weight: bold;" for="textAreaExample2">Message</label>
                            <% if(doctorAppointment.message.length == 0) { %>
                                <form style="display:flex; flex-direction:row;" action="/appointment/add-message/<%= doctorAppointment._id %>" method="post">
                                    <textarea class="form-control" id="textAreaExample2" name="message" rows="2"></textarea>
                                    <button class="Sendbtn" style=" background-color: cornflowerblue;">
                                        <div class="svg-wrapper-1">
                                        <div class="svg-wrapper">
                                            <svg
                                              xmlns="http://www.w3.org/2000/svg"
                                              viewBox="0 0 24 24"
                                              width="24"
                                              height="24">
                                              <path fill="none" d="M0 0h24v24H0z"></path>
                                              <path
                                                fill="currentColor"
                                                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
                                              ></path>
                                            </svg>
                                          </div>
                                        </div>
                                        <span>Send</span>
                                      </button>
                                    </div>
                             
                                </form> 
                              <!-- <p> High blood pressure, allergies High blood pressure, allergies High blood pressure, allergiesHigh blood pressure, allergies
                            High blood pressure, allergies High blood pressure, allergies High blood pressure, allergiesHigh blood pressure, allergies
                                </p> -->
                            <% } else { %>
                                <p><%= doctorAppointment.message %></p>
                                
                            <% } %>
                            <hr>
                            <label class="form-label" style="font-weight: bold;" for="textAreaExample2">Diagnosis</label>
                            <% if(doctorAppointment?.diagnosis?.length == 0) { %>
                                <form style="display:flex; flex-direction:row;" action="/appointment/add-diagnosis/<%= doctorAppointment._id %>" method="post">
                                    <textarea class="form-control" id="textAreaExample2" name="diagnosis" rows="2"></textarea>
                                    <button class="Sendbtn" style=" background-color: cornflowerblue;">
                                        <div class="svg-wrapper-1">
                                        <div class="svg-wrapper">
                                            <svg
                                              xmlns="http://www.w3.org/2000/svg"
                                              viewBox="0 0 24 24"
                                              width="24"
                                              height="24">
                                              <path fill="none" d="M0 0h24v24H0z"></path>
                                              <path
                                                fill="currentColor"
                                                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
                                              ></path>
                                            </svg>
                                          </div>
                                        </div>
                                        <span>Send</span>
                                      </button>
                                    </div>
                             
                                </form> 
                              
                            <% } else { %>
                                <p><%= doctorAppointment?.diagnosis %></p>
                                
                            <% } %>

                            <hr>
                            <label class="form-label" style="font-weight: bold;" for="textAreaExample2">Lab Results</label>
                            <% if(doctorAppointment?.labResults?.length == 0) { %>
                                <form style="display:flex; flex-direction:row;" action="/appointment/add-lab-results/<%= doctorAppointment._id %>" method="post">
                                    <textarea class="form-control" id="textAreaExample2" name="results" rows="2"></textarea>
                                    <button class="Sendbtn" style=" background-color: cornflowerblue;">
                                        <div class="svg-wrapper-1">
                                        <div class="svg-wrapper">
                                            <svg
                                              xmlns="http://www.w3.org/2000/svg"
                                              viewBox="0 0 24 24"
                                              width="24"
                                              height="24">
                                              <path fill="none" d="M0 0h24v24H0z"></path>
                                              <path
                                                fill="currentColor"
                                                d="M1.946 9.315c-.522-.174-.527-.455.01-.634l19.087-6.362c.529-.176.832.12.684.638l-5.454 19.086c-.15.529-.455.547-.679.045L12 14l6-8-8 6-8.054-2.685z"
                                              ></path>
                                            </svg>
                                          </div>
                                        </div>
                                        <span>Send</span>
                                      </button>
                                    </div>
                             
                                </form> 
                              
                            <% } else { %>
                                <p><%= doctorAppointment?.labResults %></p>
                                
                            <% } %>
                            
                    </td>
                    <td>
                       <% if(doctorAppointment.medicines.length == 0) { %>
                            <p class="lead" style="font-size: 0.7em;">Not added any medicine yet</p>
                       <% } else { %>
                            <p>
                            <% doctorAppointment.medicines.forEach((medicine) => { %>
                                <div class="p-2 d-flex justify-content-between align-items-center">
                                  <img width="40" style="border-radius: 5px;" src="<%= medicine.picture %>" alt="">
                                    <p class="mb-0 mx-2"><%= medicine.name %></p>
                                    
                                    <form style="margin-left: 10px;" action="/delete/medicine/<%= medicine._id %>/from/appointment/<%= doctorAppointment._id %>" method="post">
                                        <button class="btn btn-danger">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                              </svg>
                                        </button>
                                    </form>
                                </div>
                            <% }) %>
                        </p>
                       <% } %>
                        <button  data-bs-toggle="modal" data-bs-target="#add-medicine-<%= doctorAppointment._id %>" class="btn btn-outline-dark rounded-pill py-md-2 px-md-4 mx-2">Pharmacy</button>
                    </td>
                    <td>
                        <p style="text-transform: uppercase; font-weight: bold;"><%= doctorAppointment.status %></p>
                         
                     </td>
                    <td>
                        <a class="btn btn-danger" href="/decline/appointment/<%= doctorAppointment._id %>">
                            <svg  style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-x-square" viewBox="0 0 16 16">
                                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                              </svg>
                            Decline
                        </a>
                        <a class="btn btn-success mt-2" href="/accept/appointment/<%= doctorAppointment._id %>">
                            
                              <svg style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
                                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                              </svg>
                            Accept
                        </a>
                        <br>
                        <a class="btn btn-primary mt-2" href="/done/appointment/<%= doctorAppointment._id %>">
                            <svg style="margin-right: 7px;" xmlns="http://www.w3.org/2000/svg"  width="18" height="18" fill="currentColor" class="bi bi-check-square" viewBox="0 0 16 16">
                                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                <path d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                              </svg>
                            Done
                        </a>
                    </td>
                </tr>
                <div class="modal modal-xl fade" id="add-medicine-<%= doctorAppointment._id %>" tabindex="-1" aria-labelledby="add-medicine-<%= doctorAppointment._id %>Label" aria-hidden="true">
                    <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header border-0">
                        <h1 class="modal-title fs-5" id="add-medicine-<%= doctorAppointment._id %>Label"></h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body border-0">
                            <div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <h3>Pharmacy</h3>
                                    
                                </div>
                                
                                <div class="row g-5 mt-5">
                                    <% medicines.forEach((medicine) => { %>
                                        <div class="col-xl-4 col-lg-6">
                                            <div class="bg-light rounded overflow-hidden">
                                                <img class="img-fluid w-100" 
                                                 src="<%= medicine.picture %>" alt="">
                                                <div class="p-4" >
                                                   <a class="h3 d-block mb-3" id="contentToCopy"><%= medicine.name %></a>
                                                 
                                                    <p class="m-0" style="min-height: 70px; max-height: 120px; overflow: hidden;"><%= medicine.description %></p>
                                                </div>
                                          
                                                <div class="d-flex justify-content-between border-top p-4">
                                                    <form action="/send/medicine/<%= medicine._id %>/to/appointment/<%= doctorAppointment._id %>" method="post">
                                                        <button class="btn btn-dark">Send to Patient</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    <% }) %>
                                    
                                    
                                </div>
                                
                                <div class="d-flex justify-content-end align-items-center">
                                    <button class="Closebtn" data-bs-dismiss="modal" aria-label="Close">close</button>
                                </div>

                                
                            </div>
                        </div>
                        
                    </div>
                    </div>
                </div>
            <% }) %>
           
            
            
        </tbody>
    </table>
</div>


<%- include("../partials/footer.ejs") %>


<%- include("../partials/foot.ejs") %>